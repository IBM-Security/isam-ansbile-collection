#4.2 Enable NTP
ntpServers: "pool.ntp.org"
timeZone: "America/Chicago"

# "4.3 Product Activation"
activation_keys: [{id: wga, code: },
                  {id: mga, code: },
                  {id: federation, code: }
]
#4.4 Configure Runtime Interfaces
label:  '1.1'
address:  "192.168.42.102"
maskOrPrefix: "24"
allowManagement: false
enabled: true

#4.5 Update Hosts File on the Appliance
host_records: [ { addr: 192.168.42.101, hostnames: isam.myidp.ibm.com },
                { addr: 192.168.42.102, hostnames: www.myidp.ibm.com },
                { addr: 192.168.42.201, hostnames: isam.mysp.ibm.com },
                { addr: 192.168.42.202, hostnames: www.mysp.ibm.com }]


#4.6 Configure ISAM Runtime Component on the Appliance
ssl_compliance: "fips"
ps_mode: "local"
admin_cert_lifetime: "1460"
user_registry: "local"
ldap_pwd: "passw0rd"
admin_pwd: "Passw0rd"
policyserver_connection_inactivity: 0

#5.1 Create new Reverse Proxy
https_port: "443"
nw_interface_yn: "yes"
https_yn: "yes"
domain: "Default"
admin_id: "sec_master"
host: "isam.myidp.ibm.com"
inst_name: "default"
ip_address: 192.168.42.102
listening_port: "7234"
ssl_yn: no
http_yn: no

#5.2 Modify Reverse Proxy Instance Settings
set_reverseproxy_conf_entries: [{stanza_id: "server", entries: [["web-host-name", "www.myidp.ibm.com"]]},
                                {stanza_id: "step-up", entries: [["verify-step-up-user", "no"]]},
                                {stanza_id: "session", entries: [["user-session-ids", "yes"],
                                                                 ["inactive-timeout", "1800"],
                                                                 ["create-unauth-sessions", "yes"]
                                ]}
]

execute_rp_op_ids: [{id: "default"}]
execute_rp_op_operation: "restart"

#6.1 Upload keystore files
import_certificate_db_kdb: "providedfiles/myidpkeys/myidpkeys.kdb"
import_certificate_db_sth: "providedfiles/myidpkeys/myidpkeys.sth"

#6.2 Upload mapping rules
inventory_dir: "providedfiles/mappingrules/idp"
mapping_rules: [ {name: accesspolicy_prompt, category: SAML2_0, file: accesspolicy_prompt.js},
                 {name: ip_post_ldap, category: SAML2_0, file: ip_post_ldap.js},
                 {name: ip_pre_ldap, category: SAML2_0, file: ip_pre_ldap.js},
                 {name: ip_saml20_httpclient, category: SAML2_0, file: ip_saml20_httpclient.js},
                 {name: ip_saml20_httpclient_wstrust, category: SAML2_0, file: ip_saml20_httpclient_wstrust.js},
                 {name: ip_saml20, category: SAML2_0, file: ip_saml20.js},
                 {name: ivc_to_ltpa, category: SAML2_0, file: ivc_to_ltpa.js},
                 {name: ivc_to_passticket, category: SAML2_0, file: ivc_to_passticket.js},
                 {name: ivc_to_saml20, category: SAML2_0, file: ivc_to_saml20.js},
                 {name: saml20_ivc_to_saml20, category: SAML2_0, file: saml20_ivc_to_saml20.js},
                 {name: saml20_to_saml20, category: SAML2_0, file: saml20_to_saml20.js},
                 {name: stsuutostsuu, category: SAML2_0, file: stsuutostsuu.js},
                 {name: ut_to_saml20, category: SAML2_0, file: ut_to_saml20.js}
]

#6.3 Create Federation
search_mapping_rule_name: ip_saml20
ipfed: "providedfiles/ipfed.json"
fed_name: saml20idp
protocol: SAML2_0
role: ip

#6.4 Export meta-data
export_metadata_filename: "providedfiles/Automation/tmp/ipmetadata.xml"

#- 8.1 ISAM Configuration for the IdP
config_reverseproxy_federation_hostname: "127.0.0.1"
config_reverseproxy_federation_port: "443"
config_reverseproxy_federation_reuse_certs: false
config_reverseproxy_federation_reuse_acls: false

#8.1.2 Environment-specific configuration
set_reverseproxy_conf_entries_8_1_2: [{stanza_id: "TAM_CRED_ATTRS_SVC", entries: [["eperson", "azn_cred_registry_id"]]},
                                      {stanza_id: "junction:/isam", entries: [["reset-cookies-list", "*ac.uuid,*JSESSIONID"]]},
                                      {stanza_id: "TAM_CRED_ATTRS_SVC:eperson", entries: [["emailAddress", "mail"],
                                                                                          ["firstName", "cn"],
                                                                                          ["lastName", "sn"]
                                      ]}
]
